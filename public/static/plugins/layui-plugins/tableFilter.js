/** layui-v2.5.6 MIT License By https://www.layui.com */
 ;layui.define(["table","jquery","form"],function(e){var a="tableFilter",i=layui.jquery,l=layui.table,t=layui.form,n={v:"1.0.0"};n.cache={},n.render=function(e){var a=i(e.elem||"#table"),r=a.attr("id")||"table_"+(new Date).getTime(),u=e.filters||[],d=e.parent||"body",o=e.mode||"local";url=e.url||"",e.done=e.done||function(){},n.cache[r]={};var f=function(){if("local"==o){var f=n.getShowTrIndex(a,r,u);if(f.length>0){var c=a.next().find(".layui-table-body tr");c.each(function(e,a){i.inArray(i(a).data("index"),f)!=-1?i(a).removeClass("layui-hide"):i(a).addClass("layui-hide")})}else a.next().find(".layui-table-body tr").removeClass("layui-hide")}layui.each(u,function(f,c){var s=c.field,y=c.name||c.field,h=c.type||"input",p=c.data||[],b=c.url||"",v=a.next().find('.layui-table-header th[data-field="'+s+'"]'),m="input"==h?"layui-icon-search":"layui-icon-down",x=i('<span class="layui-table-filter layui-inline"><i class="layui-icon '+m+'"></i></span>');v.find(".layui-table-cell").append(x),n.cache[r][y]?x.addClass("tableFilter-has"):x.removeClass("tableFilter-has"),x.on("click",function(f){f.stopPropagation(),c.data||b||"input"==h||(p=n.eachTds(a,s));var v=i(this).offset().top+i(d).scrollTop()+i(this).outerHeight()+5+"px",m=i(this).offset().left-(i("body").outerWidth(!0)-i(d).outerWidth(!0))-164+"px",g=i('<div class="layui-table-filter-view layui-anim layui-anim-fadein" style="top:'+v+";left:"+m+';"><div class="layui-table-filter-box"><form class="layui-form" lay-filter="table-filter-form"></form></div></div>');"input"==h&&g.find("form").append('<input type="search" name="'+y+'" lay-verify="required" lay-verType="tips" placeholder="关键词" class="layui-input">'),"checkbox"==h&&(g.find("form").append("<ul></ul>"),b||layui.each(p,function(e,a){g.find("ul").append('<li><input type="checkbox" name="'+y+"["+a.key+']" value="'+a.key+'" title="'+a.value+'" lay-skin="primary"></li>')})),"radio"==h&&(g.find("form").append('<ul class="radio"></ul>'),b||(g.find("ul").append('<li><input type="radio" name="'+y+'" value="" title="All" checked></li>'),layui.each(p,function(e,a){g.find("ul").append('<li><input type="radio" name="'+y+'" value="'+a.key+'" title="'+a.value+'"></li>')}))),g.find("form").append('<button class="layui-btn layui-btn-normal layui-btn-sm" lay-submit lay-filter="tableFilter">确定</button>'),g.find("form").append('<button type="button" class="layui-btn layui-btn-primary layui-btn-sm filter-del layui-btn-disabled" disabled>取消过滤</button>'),i(this).hasClass("tableFilter-has")&&g.find(".filter-del").removeClass("layui-btn-disabled").removeAttr("disabled","disabled"),i(d).append(g),t.val("table-filter-form",n.toLayuiFrom(r,y,h)),t.render(null,"table-filter-form");var k=g.find('form input[type="search"]');if(k.focus().select(),("checkbox"==h||"radio"==h)&&b){var C=g.find(".layui-table-filter-box ul");C.append('<div class="loading"><i class="layui-icon layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop"></i></div>'),i.getJSON(b+"?_t="+(new Date).getTime(),function(e,a,i){C.empty(),"radio"==h&&C.append('<li><input type="radio" name="'+y+'" value="" title="All" checked></li>'),layui.each(e.data,function(e,a){"checkbox"==h&&C.append('<li><input type="checkbox" name="'+y+"["+a.key+']" value="'+a.key+'" title="'+a.value+'" lay-skin="primary"></li>'),"radio"==h&&C.append('<li><input type="radio" name="'+y+'" value="'+a.key+'" title="'+a.value+'"></li>')}),t.render(null,"table-filter-form"),t.val("table-filter-form",n.toLayuiFrom(r,y,h))})}t.on("submit(tableFilter)",function(t){if("checkbox"==h){var d=[];for(var f in t.field)d.push(t.field[f]);t.field[y]=d}if(n.cache[r][y]=t.field[y],n.cache[r][y].length>0?x.addClass("tableFilter-has"):x.removeClass("tableFilter-has"),"local"==o){var c=n.getShowTrIndex(a,r,u);if(c.length>0||t.field[y].length>0){var s=a.next().find(".layui-table-body tr");s.each(function(e,a){i.inArray(i(a).data("index"),c)!=-1?i(a).removeClass("layui-hide"):i(a).addClass("layui-hide")})}else a.next().find(".layui-table-body tr").removeClass("layui-hide");n.updataTotal(a),l.resize(r)}else if("api"==o){var p={};for(var f in n.cache[r]){var b=f,v=n.cache[r][f];i.isArray(v)?p[b]=v.join(","):p[b]=v}l.reload(r,{where:p,url:url})}return e.done(n.cache[r]),g.remove(),!1}),g.find(".layui-table-filter-box .filter-del").on("click",function(t){if(delete n.cache[r][y],x.removeClass("tableFilter-has"),"local"==o){var d=n.getShowTrIndex(a,r,u);if(d.length>0){var f=a.next().find(".layui-table-body tr");f.each(function(e,a){i.inArray(i(a).data("index"),d)!=-1?i(a).removeClass("layui-hide"):i(a).addClass("layui-hide")})}else a.next().find(".layui-table-body tr").removeClass("layui-hide");n.updataTotal(a),l.resize(r)}else if("api"==o){var c={};c[y]="",l.reload(r,{where:c})}e.done(n.cache[r]),g.remove()}),i(document).mouseup(function(e){var a=i(".layui-table-filter-view");a.is(e.target)||0!==a.has(e.target).length||g.remove()})})})};f();var c={config:e,reload:function(e){f()}};return c},n.eachTds=function(e,a){var l=[],t=[],r=e.next().find('.layui-table-body td[data-field="'+a+'"]');return r.each(function(e,a){l.push(i.trim(a.innerText))}),l=n.tool.uniqueObjArray(l),layui.each(l,function(e,a){t.push({key:a,value:a})}),t},n.getShowTrIndex=function(e,a,l){var t=[],r=n.cache[a];for(var u in r){var d=u,o=r[u];layui.each(l,function(e,a){d==a.name&&(d=a.field)});var f=e.next().find('.layui-table-body td[data-field="'+d+'"]'),c=[];f.each(function(e,a){i.isArray(o)?i.inArray(i.trim(a.innerText),o)>=0&&o&&o.length>0&&c.push(i(a).parent().data("index")):i.trim(a.innerText).indexOf(o)>=0&&c.push(i(a).parent().data("index"))}),t=t.length<=0?c:c.length>0?n.tool.getSameArray(t,c):i.isArray(o)?t:[]}return n.tool.uniqueObjArray(t)},n.toLayuiFrom=function(e,a,i){var l=JSON.stringify(n.cache[e]);return l=JSON.parse(l),"checkbox"==i&&(layui.each(l[a],function(e,i){l[a+"["+i+"]"]=!0}),delete l[a]),l},n.updataTotal=function(e){var a=e.attr("id");l.eachCols(a,function(a,l){if(l.totalRow){var t=0,n=e.next().find('.layui-table-body td[data-field="'+l.field+'"]');n.each(function(e,a){i(a).parent().hasClass("layui-hide")||(t=(10*t+10*Number(i.trim(a.innerText)))/10)});var r=e.next().find('.layui-table-total td[data-field="'+l.field+'"]');r.each(function(e,a){i(a).find(".layui-table-cell").html(t||"0")})}})},n.hide=function(){i(".layui-table-filter-view").remove()},n.tool={uniqueObjArray:function(e,a){var i=[],l=[];if(0==e.length)return e;if(a){for(var t=0;t<e.length;t++)l[e[t][a]]||(i.push(e[t]),l[e[t][a]]=!0);return i}for(var t=0;t<e.length;t++)l[e[t]]||(i.push(e[t]),l[e[t]]=!0);return i},getSameArray:function(e,a){for(var i=[],l=0;l<e.length;l++)for(var t=0;t<a.length;t++)a[t]===e[l]&&i.push(a[t]);return i}},e(a,n)}).addcss("modules/tableFilter.css","tableFilterCss");